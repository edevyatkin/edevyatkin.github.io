---
layout: post
title:  "Стеклянные шары и небоскрёб"
date:   2016-07-01 18:50:00 +0300
categories: problems
---
Изучая алгоритмы и решая различные задачи порой сталкиваешься с такими, которые простые лишь с виду. А на деле имеют весьма оригинальное решение, дойти до которого сходу ну никак нельзя.

### Условие
Итак, мы стоим возле высокого небоскрёба высотой в 100 этажей. Нам дали два стеклянных шара. Да таких, что их стекло достаточно прочное, чтобы выдержать падение с высоты нескольких десятков или даже сотен метров.
Записка: «Есть этаж, начиная с которого эти шары начинают разбиваться. За какое минимальное количество бросков мы гарантированно его определим?».

<!--more-->

### Решение
Немного подумав, решим так: раз у меня есть два шара, то я могу бросить шар с какого-нибудь этажа и посмотреть, разобьётся или нет. Будем хитрее и выберем 50-тый этаж, ровно посередине.

«Итак, вперед, идем в лифт… Стоп! А если шар разобьется, что же тогда делать? У меня останется всего один шар, но зато я буду знать что искомый этаж максимум 50-тый. А если 49? Или 48? А может вообще первый? Можно бросить наугад, например, с 25-го. А если и он разобьется? Тогда я точно не узнаю нужный этаж. Тут нужен правильный подход…».

Конечно, шар может и не разбиться с 50-го этажа. Тогда мы можем бросать дальше. Например, с 75-го. Здесь мы используем алгоритм [двоичного поиска](https://ru.wikipedia.org/wiki/%D0%94%D0%B2%D0%BE%D0%B8%D1%87%D0%BD%D1%8B%D0%B9_%D0%BF%D0%BE%D0%B8%D1%81%D0%BA). Благодаря логарифмической сложности по времени и не без _удачи_ сможем найти нужный этаж за небольшое количество бросков.

Например, если нужный нам этаж - 51, то для его определения _может_ быть достаточно 3 броска:

* 50 (первый шар не разбился),
* 75 (первый шар разбился),
* 51 (второй шар разбился, уже не используем двоичный поиск).

Однако, здесь следует учесть, что для решения нужно брать во внимание наихудший случай. Для «удачных» вариантов, как в примере выше, считать броски не имеет смысла, так как наилучший случай: один бросок с первого этажа — шар разбился. Нам он не интересен.

Наихудшим случаем будет бросок с 50-го этажа (предполагаем, что нам хватило ума не кидать откуда-то с самого верха небоскрёба) и разбившийся от этого шар. А искомый этаж — 49. Единственным решением в этом случае будет бросать оставшийся второй шар, начиная с первого этажа до 49-го. В итоге мы потратим 1 + 49 = 50 бросков.

Много.

Разве нельзя меньше? Может стоит бросать по-другому? Очевидно, да.

Таким образом, мы ищем наилучший случай из наихудших. В данном случае — [минимакс](https://ru.wikipedia.org/wiki/%D0%9C%D0%B8%D0%BD%D0%B8%D0%BC%D0%B0%D0%BA%D1%81).

Предположим, что искомое количество бросков равно \\(X\\). Каждый раз бросая шар мы должны учитывать, что общее количество бросков не должно превысить \\(X\\). Как этого достичь?

В примере выше, когда шар разбивается уже после первого броска, нам приходится бросать начиная с самого первого. Значит, первый бросок нужно сделать с расчётом, что нам понадобится перебирать этажи ниже него. А это возможно лишь в одном случае — если мы бросали с этажа под номером \\(X\\). Если же шар не разбился, то у нас осталось еще \\(X-1\\) бросков. Возникает та же ситуация: нам нужно бросить с такого этажа, чтобы в случае, если шар разобьется, общее количество бросков не превысило \\(X-1\\). Так как мы делаем уже второй бросок, то лучшим решением будет бросить на \\(X-2\\) этажа выше, чем \\(X-1\\) этаж. И так будет повторяться каждый раз, пока мы не дойдем до вершины небоскрёба.

Нетрудно видеть, что в результате мы получим последовательность:

\\[
X + (X - 1) + (X - 2) + … + 1
\\]

Для получения уравнения достаточно приравнять эту последовательность к нашему числу этажей в небоскрёбе — 100. Однако, может получиться нецелое число, что, конечно, нам не подойдет. Поэтому искомое неравество будет выглядеть:

\\[
X + (X - 1) + (X - 2) + … + 1 \ge 100
\\]

Cумма в левой части ни что иное, как сумма арифметической прогрессии. Получаем:

\\[
\frac{X*(X+1)}{2} \ge 100
\\]

Решив неравенство, получим:

\\[
X \ge 14
\\]

Нам нужно минимальное количество бросков, следовательно:

\\[
X = 14
\\]

Таким образом, следует бросать со следующих этажей:

\\[
14, 27, 39, 50, 60, 69, 77, 84, 90, 95, 99, 100
\\]

Рассмотрим пример. Если первый шар разбился, например, на 77 этаже (к этому моменту мы сделаем 7 бросков), то продолжаем бросать так:

\\[
70, 71, 72, 73, 74, 75, 76
\\]

В худшем случае, если искомый этаж 76 или 77, получим еще 7 бросков. Итого — 14.

Итоговое количество бросков будет тем меньше, чем ближе номер искомого этажа к левой границе отрезков \\([1;14], [14;27], [27;39]\\) и т.д.

### Ответ
Для **гарантированного** определения этажа, с которого начинают разбиваться стеклянные шары, нужно **минимум 14 бросков**.

### Реализация
Для вычисления минимального количества бросков можно использовать методику динамического программирования. 

[Исходный код реализации на C#](https://github.com/edevyatkin/algorithms-csharp/blob/33c3bc76fb4bb8ff798514efed0000850539efbc/BallsAndSkyscraper.NetCore/Program.cs)

